@startuml
skinparam classAttributeIconSize 0
skinparam monochrome true
skinparam shadowing false

package "com.example (Core Logic)" {
    class Game {
        - board: Board
        - playerBlack: Player
        - playerWhite: Player
        - currentPlayer: StoneColor
        - ruleEngine: RuleEngine
        - blackPrisoners: int
        - whitePrisoners: int
        - dbGameId: Long
        + addPlayer(player: Player)
        + processMove(x: int, y: int, color: StoneColor)
        + processPass(color: StoneColor)
        + processSurrender(color: StoneColor)
    }

    class Board {
        - size: int
        - grid: StoneColor[][]
        + getStone(x: int, y: int): StoneColor
        + setStone(x: int, y: int, color: StoneColor)
        + getBoardStateString(): String
        + getGridCopy(): StoneColor[][]
    }

    class RuleEngine {
        - stateOneTurnAgo: StoneColor[][]
        - stateTwoTurnsAgo: StoneColor[][]
        + isMoveValid(board, x, y, color): boolean
        + checkCaptures(board, x, y, color): boolean
        - findGroupAndLiberties(...)
    }

    enum StoneColor {
        BLACK
        WHITE
        EMPTY
    }
}

package "Networking & Clients" {
    interface Player {
        + sendMessage(msg: String)
    }

    class ClientHandler <<Runnable>> {
        - socket: Socket
        - game: Game
        - color: StoneColor
        + run()
        + sendMessage(msg: String)
    }

    class BotPlayer <<Runnable>> {
        - game: Game
        - myColor: StoneColor
        + makeBestMove()
        + sendMessage(msg: String)
    }

    class GoServer {
        {static} - instance: GoServer
        - serverSocket: ServerSocket
        + start(port, size, playWithBot)
    }

    class GoClient {
        - socket: Socket
        - gui: GoApplication
        + connect(ip, port)
        + sendMove(x, y)
        + sendPass()
    }
}

package "Commands" {
    interface Command {
        + execute()
    }

    class MoveCommand {
        - x, y: int
        + execute()
    }
    class PassCommand {
     + execute() }
    class SurrenderCommand {
     + execute() }
    class ResumeCommand {
     + execute() }
}

package "Persistence (Spring Boot)" {
    class GameEntity {
        - id: Long
        - startTime: LocalDateTime
        - result: String
    }

    class MoveEntity {
        - x, y, moveNumber: int
        - type: String
    }

    class GameService {
        + createNewGame(size): Long
        + saveMove(...)
        + playReplayForClient(gameId, client)
    }
}

package "View (JavaFX)" {
    class GoApplication <<Application>> {
        - client: GoClient
        - boardPane: Pane
        + start(stage)
        + updateBoard(state)
    }
    class AlertView {
        + showAlert(title, msg, type)
    }
}

' Relationships
Game *-- Board
Game *-- RuleEngine
Game o-- Player
RuleEngine ..> Board

ClientHandler ..|> Player
BotPlayer ..|> Player
ClientHandler --> Command : creates
MoveCommand ..|> Command
PassCommand ..|> Command
SurrenderCommand ..|> Command
ResumeCommand ..|> Command
Command --> Game : executes on

GoServer --> Game
GoServer --> ClientHandler
GoClient --> GoApplication
GoApplication --> GoClient

GameService --> GameEntity
GameService --> MoveEntity
Game --> GameService

@enduml